# DrawDashBoard

<div align="center">

![DrawDashBoard Logo](static/favicon.svg)

**Sketch ideas · organize visually**  
SvelteKit + Svelte 5 Runes 기반 드로잉 보드 툴 — Cloudflare Pages 배포 지원

</div>

---

## 🎨 브랜딩 & 로고

DrawDashBoard의 로고는 손그림 스타일의 'D' 이니셜과 물결선으로 구성되어 있습니다.

- **디자인 컨셉**: 드로잉 보드와 다이어그램 그리기 도구라는 특성을 반영한 손그림 스타일
- **로고 파일**: `static/favicon.svg` (배경 없는 SVG, 파비콘 및 메인 로고로 사용)
- **색상**: 파란색→보라색 그라디언트 (D 이니셜) + 주황색 물결선 (밑줄)
- **사용 위치**: 
  - 브라우저 파비콘 (`+layout.svelte`, `app.html`)
  - 메인 페이지 헤더 로고 (`+page.svelte`)
  - 소셜 공유 이미지 (`og-image.svg`)

---

## 📐 화면 구조

```
┌─────────────────────────────────────────────────────────────────┐
│  메인 (/)                                                        │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  🎨 DrawDashBoard   Sketch ideas · organize …            │   │
│  └──────────────────────────────────────────────────────────┘   │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐                   │
│  │ ➕ 새  │ │ Board1 │ │ Board2 │ │ Board3 │  …               │
│  │ 보드   │ │ thumb  │ │ thumb  │ │ thumb  │                   │
│  └────────┘ └────────┘ └────────┘ └────────┘                   │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│  보드 편집 (/board/[id])                                         │
│  ┌──────────────────────── Topbar ───────────────────────────┐  │
│  │  🏠  [제목]  💾 📄 🖼️ 📥 🧹  ↩ ↪  (아이콘 + 툴팁)      │  │
│  └───────────────────────────────────────────────────────────┘  │
│  ┌──────────┐ ┌──────────── BoardStage ────────┐ ┌───────────┐  │
│  │ToolPanel │ │                                │ │ Minimap   │  │
│  │ 선택     │ │     <canvas> + HTML overlays   │ │ 썸네일    │  │
│  │ 펜       │ │     ↕ ← 확장 버튼 (뷰포트 중앙)│ ├───────────┤  │
│  │ 지우개   │ │                                │ │ Property  │  │
│  │ 사각형   │ └────────────────────────────────┘ │ Panel     │  │
│  │ 원       │                                    │           │  │
│  │ 삼각형   │                                    │           │  │
│  │ 가로선   │                                    └───────────┘  │
│  │ 세로선   │                                                    │
│  │ 텍스트   │                                                    │
│  │ 이미지   │                                                    │
│  │ ─────── │                                                    │
│  │ 🔒도구고정│                                                   │
│  └──────────┘                                                    │
└─────────────────────────────────────────────────────────────────┘
```

---

## ✨ 주요 기능

### 메인 화면

| 기능 | 설명 |
|------|------|
| 보드 목록 | 최근 수정순 정렬, 16:9 썸네일 미리보기 |
| 새 보드 | 그리드 첫 번째 카드에서 바로 생성 |
| 테마 선택 | 화이트보드 / 칠판 / 네온 그리드 |
| 카드 삭제 | 호버 시 우상단 삭제 아이콘 표시 |
| 제목 툴팁 | 긴 이름 말줄임표(…) 시 호버로 전체 표시 |

### 상단 툴바 (Topbar)

모든 버튼이 아이콘으로 표시되며 호버 시 툴팁으로 기능을 안내합니다.

| 버튼 | 기능 |
|------|------|
| 🏠 홈 | 보드 목록으로 이동 |
| 📄 PDF 내보내기 | `.pdf` 파일로 내보내기 |
| 🖼️ 이미지 내보내기 | 전체 해상도 `.png` 다운로드 |
| 📥 보드 불러오기 | 다른 보드 내용을 현재 보드로 병합 |
| 🧹 보드 초기화 | 보드 전체 초기화 (내용·크기·Undo/Redo 히스토리 모두 리셋) |
| ↩ 실행 취소 | Undo |
| ↪ 다시 실행 | Redo |

저장은 수동 버튼 없이 **5초마다 자동 저장**됩니다. (보드 제목 변경 포함 모든 수정사항 반영)

### 도구 패널 (좌측)

| 도구 | 기능 |
|------|------|
| ➤ 선택 | 드래그 이동 · 범위 선택(마키) · 회전 · 크기 조절 |
| ✏️ 펜 | 자유 드로잉, 색상/굵기 설정 |
| 🧹 지우개 | 펜 획 정밀 삭제 (Bezier 평탄화 + 원–선분 교차 알고리즘), 크기 설정, 핑크 글래스 커스텀 커서 |
| ⬜ 사각형 | 내부 텍스트 입력 지원 |
| ⭕ 원 | SVG 렌더링으로 찌그러짐 없음, 내부 텍스트 지원 |
| △ 삼각형 | SVG polygon으로 정확한 외곽선 |
| ━ 가로선 | 수평 직선 |
| ┃ 세로선 | 수직 직선 |
| 🔤 텍스트 | 텍스트 박스, 좌·중·우 정렬, 테두리 두께 0으로 숨기기 |
| 🖼️ 이미지 | 이미지 영역 추가 → 속성 패널에서 파일 선택, 영역에 fit |
| 🔒 도구 고정 | 활성화 시 도구 사용 후 선택 도구로 자동 복귀하지 않음 |

### 미니맵 (우측 상단)

속성 패널 위에 고정된 실시간 썸네일입니다.

| 기능 | 설명 |
|------|------|
| 실시간 썸네일 | 보드의 현재 상태를 즉시 반영 (DPR×2 고화질 렌더링) |
| 뷰포트 인디케이터 | 현재 화면에 보이는 영역을 파란 박스로 표시 |
| 클릭·드래그 스크롤 | 미니맵에서 인디케이터를 드래그하면 보드가 해당 위치로 스크롤 |
| 영역 제한 | 인디케이터를 보드 경계 밖으로 이동 불가 |
| 고정 크기 | 보드 크기와 무관하게 미니맵 패널 크기는 항상 일정, 내부 축척만 변화 |

### 요소 조작

```
선택된 요소
  ├─ 드래그         : 이동
  ├─ 코너 핸들      : 크기 조절 (이미지는 비율에 맞게 fit)
  ├─ 회전 핸들      : 자유 회전 (rotation°)
  ├─ 더블클릭       : 텍스트 편집 모드 (rect / ellipse / text)
  ├─ Ctrl+D         : 복제
  └─ Delete         : 삭제

다중 선택 (마키 or Shift 클릭)
  ├─ 정렬   : 좌 / 가운데 / 우 / 상 / 중간 / 하
  ├─ 분배   : 가로 간격 균등 / 세로 간격 균등
  └─ 그룹   : 그룹화 / 그룹 해제
```

### 속성 패널 (우측)

| 섹션 | 기능 |
|------|------|
| 색상 | 선(Stroke) / 채우기(Fill) 색상 스와치 |
| 테두리 | 두께 슬라이더 0–12px (text 요소: 0 = 점선 숨김) |
| 폰트 크기 | rect / ellipse / text 선택 시 표시, 슬라이더 + 프리셋 버튼 (8–96px) |
| 이미지 | image 요소 선택 시 표시, 파일 탐색기로 이미지 불러오기 |
| 펜 크기 | 펜 굵기 슬라이더 |
| 지우개 | 지우개 크기 슬라이더 (지우개 도구 활성 시만 표시) |
| 스냅 | 스냅 민감도 슬라이더 |
| 테마 | 화이트보드 / 칠판 / 네온 그리드 전환 |
| 격자 | 격자 표시 토글 + 간격 슬라이더 (8–96px, 프리셋: 촘촘·보통·넓게) |
| 정렬 | 다중 선택 시: 좌·중·우·상·중간·하 정렬 + 가로·세로 균등 분배 |
| 텍스트 가로 정렬 | 텍스트 편집 요소 선택 시: 좌·중·우 |
| 텍스트 세로 정렬 | 텍스트 편집 요소 선택 시: 상단·중간·하단 |
| 보드 크기 | 현재 보드 너비 × 높이 표시, 상·하·좌·우 200px 확장 버튼 |

### 지우개 알고리즘

지우개는 펜 획에 대해서만 작동하며, 정밀한 부분 삭제를 지원합니다.

```
지우개 처리 파이프라인
  ┌──────────────────────────────────────────────────────┐
  │ ❶ 빠른 거부 — 원점(raw points) 기준으로 교차 여부    │
  │    확인. 교차 없으면 stroke 그대로 유지 (O(1) 비용)   │
  ├──────────────────────────────────────────────────────┤
  │ ❷ Bezier 평탄화 — drawStroke가 렌더링하는 실제       │
  │    곡선 경로를 ~3px 간격의 밀집 폴리라인으로 변환     │
  │    → 이후 분할 시 곡선 모양 변형(움찔거림) 방지       │
  ├──────────────────────────────────────────────────────┤
  │ ❸ 원–선분 교차 + 경계점 보간                         │
  │    ① 양 끝 바깥 → 원 관통 시 진입점/이탈점에서 분할   │
  │    ② 양 끝 내부 → 삭제                               │
  │    ③ 바깥→안쪽 → 원 경계 진입점 추가 후 구간 종료     │
  │    ④ 안쪽→바깥 → 원 경계 이탈점에서 새 구간 시작      │
  ├──────────────────────────────────────────────────────┤
  │ ❹ 경로 보간 — 마우스 이동 경로를 따라 지우개 원을     │
  │    radius px 간격으로 배치하여 빠른 이동에도 빈틈 없음  │
  └──────────────────────────────────────────────────────┘
```

| 특징 | 설명 |
|------|------|
| Bezier 평탄화 | 실제 렌더 경로 위의 점으로 변환 → 삭제 후 남은 곡선 모양 보존 |
| 원–선분 교차 | 정확한 이차방정식 풀이로 경계점 계산 → 과도한 삭제 방지 |
| 핑크 글래스 커서 | 비활성(호버) = 반투명 핑크, 활성(클릭) = 빨간 글로우 + 스케일 |
| 펜 전용 | `stroke.tool === 'pen'`만 삭제, 도형·텍스트·이미지 무관 |

### 스냅 & 스마트 가이드

- **캔버스 스냅** : 중심선, 상/하/좌/우 테두리 스냅
- **요소 스냅** : 다른 요소의 모서리·중심에 자동 정렬
- **Gap Match** : 요소 간 간격이 동일할 때 스냅
- **거리 숫자 표시** : 스마트 가이드에 실제 px 거리 표시
- **민감도 슬라이더** : 옵션 패널에서 SNAP_THRESHOLD 조절

### 내보내기 & 저장

| 방식 | 형식 | 특징 |
|------|------|------|
| 자동 저장 | IndexedDB | **5초마다** 변경사항 자동 저장 (보드 제목·내용·격자 등). 썸네일 자동 생성, 대용량 보드 지원 |
| PDF 내보내기 | `.pdf` | jsPDF, 보드 크기 그대로 (격자 설정 반영) |
| 이미지 내보내기 | `.png` | 전체 해상도 PNG 다운로드 (격자 설정 반영) |
| 보드 불러오기 | 복사 붙여넣기 | 다른 보드 내용을 현재 보드로 병합 |

### 저장되지 않은 변경사항 경고

- **수정사항** : 보드 제목 변경, 드로잉·요소·설정 변경 시 모두 "수정사항"으로 인식
- **내부 이동** : SvelteKit `beforeNavigate` 훅으로 감지 → 커스텀 모달 표시 (저장하고 나가기 / 저장 없이 나가기 / 취소)
- **탭 닫기 / 새로고침** : `window.beforeunload` 이벤트로 브라우저 기본 경고 표시
- **오탐 방지** : 보드 최초 진입(불러오기) 시에는 수정사항 없음으로 유지 — 아무 편집도 하지 않고 나가면 경고 없음

### 보드 캔버스

- **무한 확장** : 상/하/좌/우 가장자리 hover → 글래스모피즘 버튼으로 200px 확장 (현재 뷰포트 중앙에 버튼 표시)
- **크기 저장** : 확장된 너비/높이가 저장되어 재접속 시에도 유지
- **기본 크기** : 브라우저 뷰포트 크기에 맞춰 자동 설정 (신규 보드 생성 또는 초기화 시)
- **Undo / Redo** : 보드 크기 변경(확장)·격자 설정 변경까지 포함한 전체 작업 히스토리 스냅샷 방식
- **전체 초기화** : 보드 내용·크기·Undo/Redo 히스토리를 모두 초기화
- **격자** : 표시 여부 및 간격(8–96px)을 자유롭게 설정, 저장·내보내기에 반영
- **스크롤바** : 슬림한 커스텀 스크롤바 스타일 (Webkit + Firefox)

---

## 🏗️ 프로젝트 구조

```
drawBoard/
├── static/                          # 정적 파일 (루트에 서빙)
│   ├── favicon.svg                 # 로고 (손그림 스타일 'D' + 물결선)
│   ├── og-image.svg                # 소셜 공유 이미지 (Open Graph)
│   ├── robots.txt                  # 검색 엔진 크롤러 규칙
│   └── sitemap.xml                 # 사이트맵
└── src/
    ├── app.html                    # Google Fonts (Caveat, DM Sans) 로드, SEO 메타 태그
    ├── routes/
    │   ├── +layout.svelte          # 파비콘 설정 (static/favicon.svg 참조)
    │   ├── +page.svelte            # 메인 (보드 목록, 로고 표시)
    │   └── board/[id]/
    │       └── +page.svelte        # 보드 편집 (핵심 로직)
    └── lib/
        ├── board-types.ts          # 전체 타입 정의 + 상수 (Snapshot 포함)
        ├── board-storage.ts        # 보드 CRUD (IndexedDB 사용, 비동기 API)
        ├── canvas-renderer.ts      # Canvas 렌더링 (획·도형·텍스트·썸네일)
        ├── snap-engine.ts          # 스냅·가이드 계산 엔진
        ├── db/                     # IndexedDB 레이어
        │   ├── schema.ts           # DB 이름, 스토어 이름, 버전
        │   ├── client.ts            # DB 연결 열기/닫기
        │   ├── boards.ts            # 보드 스토어 getAll/get/put/delete
        │   └── index.ts             # re-export
        └── component/
            ├── home/
            │   ├── BoardCard.svelte         # 보드 카드 (썸네일, 삭제 버튼)
            │   └── CreateBoardModal.svelte  # 새 보드 생성 모달
            └── board/
                ├── Topbar.svelte            # 상단 툴바 (아이콘 버튼 + 툴팁)
                ├── ToolPanel.svelte         # 좌측 도구 패널 (도구 고정 토글 포함)
                ├── PropertyPanel.svelte     # 우측 속성 패널 (격자 설정 포함)
                ├── BoardStage.svelte        # 드로잉 영역 (canvas + HTML overlay)
                ├── MinimapThumbnail.svelte  # 미니맵 (실시간 썸네일 + 뷰포트 인디케이터)
                └── ImportModal.svelte       # 보드 불러오기 모달 (썸네일 포함)
```

---

## 🗄️ 데이터 모델

```
BoardData
 ├── id, title, themeId
 ├── createdAt, updatedAt
 ├── width, height          ← 보드 크기 (확장 후에도 유지)
 ├── gridEnabled            ← 격자 표시 여부 (기본값: true)
 ├── gridSize               ← 격자 간격 px (기본값: 32)
 ├── thumbnail              ← JPEG base64, 저장 시 자동 생성
 ├── strokes[]              ← 펜 획 (points 배열)
 └── elements[]             ← 도형/텍스트/이미지 요소
      ├── type: rect | ellipse | triangle | line-h | line-v | text | image
      ├── x, y, width, height
      ├── rotation, borderWidth
      ├── strokeColor, fillColor
      ├── text, textAlign, textVerticalAlign, fontSize  ← rect/ellipse/text 전용
      ├── imageDataUrl?      ← image 전용, base64 data-URL
      └── groupId            ← 그룹화 연결 키

Snapshot (Undo/Redo 히스토리 단위)
 ├── strokes[]
 ├── elements[]
 ├── themeId
 ├── stageWidth             ← 보드 너비 (확장 undo/redo 지원)
 ├── stageHeight            ← 보드 높이 (확장 undo/redo 지원)
 ├── gridEnabled            ← 격자 표시 여부 (undo/redo 지원)
 └── gridSize               ← 격자 간격 (undo/redo 지원)
```

---

## 🎨 테마

| 테마 | 배경 | 격자 | 기본 펜 색 |
|------|------|------|-----------|
| 화이트보드 | `#ffffff` | 연한 회색 | `#111827` |
| 칠판 | `#10362f` | 반투명 흰색 | `#f8fafc` |
| 네온 그리드 | `#080c24` | 하늘색 glow | `#e2e8f0` |

---

## 🚀 개발 & 배포

```sh
# 의존성 설치
npm install

# 개발 서버
npm run dev

# 타입 검사
npm run check

# 프로덕션 빌드
npm run build

# Cloudflare Workers 로컬 미리보기
npm run preview:worker

# Cloudflare 배포 (wrangler login 선행)
npm run deploy
```

> **Tech Stack** : SvelteKit · Svelte 5 Runes · TypeScript · jsPDF · Cloudflare Pages (`@sveltejs/adapter-cloudflare`)  
> **데이터 저장** : IndexedDB (브라우저 내장, 용량 제한 완화). 기존 localStorage 데이터는 최초 로드 시 자동 이전 후 삭제됨.

---

## 📝 최근 변경 사항

### 보드 카드 UI 개선 (2025)

- **코너 전용 테두리**: 카드 전체가 아닌 네 모서리만 L자형 테두리로 표시 (`BoardCard.svelte`). CSS 변수 `--corner`, `--corner-len`, `--corner-color`(#334155)로 조절
- **그림자 강화**: 기본·호버 시 다층 box-shadow 적용. 호버 시 더 큰 오프셋/블러로 카드가 떠 있는 느낌 강화

### 로고 시스템 개선 (2025)

- **로고 통합**: 인라인 SVG 로고를 `static/favicon.svg` 파일로 통합하여 중복 제거 및 유지보수성 향상
- **파비콘 적용**: `+layout.svelte`와 `app.html`에서 `static/favicon.svg`를 직접 참조하도록 변경
- **로고 디자인**: 손그림 스타일의 'D' 이니셜 + 물결선 밑줄로 드로잉 보드 특성 반영
- **사용 위치**:
  - 브라우저 탭 파비콘
  - 메인 페이지 헤더 로고 (`<img src="/favicon.svg">`)
  - 소셜 공유 이미지 (og-image.svg)
